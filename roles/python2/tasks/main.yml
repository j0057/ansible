- name: ensure get-pip.py is available
  get_url:
  args:
    url: https://bootstrap.pypa.io/get-pip.py
    dest: /root/get-pip.py
  tags: python2

- name: ensure pip is installed
  shell: python2.7 /root/get-pip.py
  args:
    creates: /usr/bin/pip
  tags: python2

- name: install packages
  pip:
  args:
    name: "{{ item }}"
    state: latest
    extra_args: "--no-index --find-links {{ pypkg_url }}"
  with_items: [pip, setuptools, setuptools-metadata, setuptools-version-command, virtualenv, wheel]
  tags: python2

- name: create virtualenvs
  pip:
  args:
    name: "{{ item.pkg }}"
    virtualenv: "{{ item.dir }}"
    extra_args: "--no-index --find-links {{ pypkg_url }}"
    state: present
  with_items: python2.virtualenvs
  tags: python2
