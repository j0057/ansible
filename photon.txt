#!/bin/bash -e

create_partitions() {
    partition /dev/sda \
        "1  1M:+1M      ef02    bios    -       -" \
        "3  0:+16G      8300    root    ext4    /" \
        "2  0:+256M     8300    boot    ext4    /boot" \
        "4  0:0         8300    home    ext4    /home"
}
export -f create_partitions

create_netctl_profiles() {
    lines "/etc/udev/rules.d/10-network.rules" \
        "SUBSYSTEM==\"net\", ACTION==\"add\", ATTR{address}==\"00:01:c0:18:06:39\", NAME=\"net0\"" \
        "SUBSYSTEM==\"net\", ACTION==\"add\", ATTR{address}==\"00:01:c0:18:27:84\", NAME=\"net1\"" \
        "SUBSYSTEM==\"net\", ACTION==\"add\", ATTR{address}==\"00:01:c0:18:27:85\", NAME=\"net2\"" \
        "SUBSYSTEM==\"net\", ACTION==\"add\", ATTR{address}==\"00:01:c0:18:27:86\", NAME=\"net3\""

    lines "/etc/netctl/net0" \
        "Interface=net0" \
        "Connection=ethernet" \
        "IP=dhcp"

    netctl enable net0
}
export -f create_netctl_profiles

export INSTALL_HOST="${1:-j0057.github.io/ansible}"
export INSTALL_HOSTNAME="photon"
export INSTALL_TZNAME="Europe/Amsterdam"
export INSTALL_LOCALE="en_US.UTF-8 UTF-8"
export INSTALL_PACKAGES="base grub lsb-release python2 openssh"

bash -e <(curl -s "http://${INSTALL_HOST}/arch_stage0.txt")
