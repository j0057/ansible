#!/bin/bash -e

create_partitions() {
    partition "/dev/sda" "mbr" \
        "2  +0:+16384M  8300    root    ext4    /" \
        "1  1M:+1023M   8300    boot    ext4    /boot" \
        "3  +0:+131072M 8300    home    ext4    /home" \
        "4  +0:+4096M   8200    swap    swap    -"
}
export -f create_partitions

create_netctl_profiles() {
    lines "/etc/udev/rules.d/10-network.rules" \
        "SUBSYSTEM==\"net\", ACTION==\"add\", ATTR{address}==\"00:26:22:0f:d3:8f\", NAME=\"net0\"" \
        "SUBSYSTEM==\"net\", ACTION==\"add\", ATTR{address}==\"00:26:5e:68:0a:39\", NAME=\"wlan0\""

    lines "/etc/netctl/net0-dhcp" \
        "Interface=net0" \
        "Connection=ethernet" \
        "IP=dhcp"

    netctl enable net0
}
export -f create_netctl_profiles

post_install() {
    sed -i 's/^#\?HandleLidSwitch=.*$/HandleLidSwitch=ignore/' /etc/systemd/logind.conf
}
export -f post_install

export INSTALL_HOST="${1:-j0057.github.io/ansible}"
export INSTALL_HOSTNAME="neutrino"
export INSTALL_TZNAME="Europe/Amsterdam"
export INSTALL_LOCALE="en_US.UTF-8 UTF-8"
export INSTALL_PACKAGES="base grub lsb-release openssh python2 vim-minimal
    tmux htop bind-tools
    wpa_supplicant wpa_actiond
    xorg-server xorg-drivers
    lightdm lightdm-gtk-greeter
    xfce4 xfce4-goodies
    chromium
    haveged powertop"
export INSTALL_SERVICES="sshd.service lightdm.service haveged.service multi-user.target"

source <(curl -s "http://${INSTALL_HOST}/arch_stage0.txt")
